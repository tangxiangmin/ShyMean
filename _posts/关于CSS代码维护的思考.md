---
title: 关于CSS代码维护的思考
date: 2016-12-27 23:11:15
tags:
	- 工程化
categories:
	- CSS
---

最近有个项目，已经开发了近两个月，然后客户说之前他们提供的设计图不满意，然后前端页面全部重新修改，个人中心页面维持现状并作相应调整...整个人都不好了，维护CSS代码真是一件可怕的事情，尽管是自己写的。这几天被折磨的死去活来，总结了一点经验，希望以后少给自己以及后面的哥们挖坑。

<!--more-->

社区和论坛上到处都在谈论模块化，组件化，对于这些我只是略有耳闻，未曾深入，总觉得过于高深莫测，不太适合现在的我。就我本人而言，目前得到的关于维护CSS代码的教训有三个方面：
* 组织合理的文件目录结构
* 正确的样式命名和代码重用
* 写文档！写文档！写文档

## 文件目录
之前的项目一直是按照最基本的“根据资源划分目录”，即在根目录下：
```
- css
- js
- img
- fonts
- ...
```
好吧，这是刚学切页面时所使用的目录划分。这种结构真的是太脆弱了！临时占位图片，精灵图混在一起；scss，项目CSS，外部CSS文件混在一起；不同页面的html文档也混在一起；JS这里就不说了。改个东西需要在一堆文件里面找半天。
总之，要避免无法维护的风险，一定要划分一个良好的目录结构。论坛上有一种按照模块分目录的做法：将一个模块（比如登陆）相关的`html`,`css`,`js`和其他相关的文件关联在一起，修改的时候可以很轻松的定位到相关文件，但是整个页面就比较分散，（我们后台使用TP框架，用这种结构分目录很难被后端同事接受）。
结合实际生成环境，我尝试采用了下面目录结构来管理页面和样式表，尽管可能还是不合理，但确实比之前要好的多了：
```
- css
	-  main // 用来存放编译后的CSS文件
	-  plugin // 用来存放外部插件的CSS依赖文件
- img
	- tmp // 临时的占位图片，比如轮播，广告，商品头像啥乱七八糟的
	- sprite // 精灵图
- scss
	- animate // 动画
	- base // 基础
	- utils // 组件
	- layout // 布局
	- page // 不同页面的布局样式
		- page1
		- page2
	- main.scss // 引入下面的各个入口文件并输出单个main.css样式表
	- _animate.scss // animate文件夹样式表的引入入口文件，下同
	- _base.scss
	- _confit.scss // 配置项目相关的变量，如基础边距，基础色等
	- _layout.scss
	- _utils.scss
	- _page.scss
- html
	- page1 // 一组功能相近的页面
	- page2 // 另一组功能相近的页面
```

用scss写样式表，是一件让人身心愉悦的事情。这里先谈scss在目录划分中的作用。
使用scss的`@import`将不同模块和功能的样式表分离，管理起来就十分方便，此外，将单个样式表的规模减小，并同意在单个入口文件中进行加载管理维护起来更加轻松，根据相应的文件名可以迅速定位到需要修改的文件（必要情况下可以添加静默注释）。在`main.scss`中按依赖顺序引入相关的样式表入口文件，编译输出到`/css/`文件夹下。

分离的样式表实际上也可以按照某些的规律归拢在一起。

### 基础样式
在之前的工作中，我整理了关于自己的一套基础样式，包括：
* `_reset` 样式重置，选择性的重置部分标签（我一般都是表单元素和盒子模型）
* `_css3` 主要定义了一些CSS3属性混合器，之后就不用书写浏览器前缀了，实际上在webstrom中安装了prefix之后是可以不用再考虑前缀的问题，看个人习惯
* `_color` 定义页面相关页面的变量，以及背景色和字体色颗粒类，防止某些抽疯的需求，其他样式表中不要再出现独立的颜色
* `_font` 定义字体相关的变量和属性

上面这些基础样式都保存在`scss/base`文件夹下，除了`_color`和`_font`，其余的基础样式表改动可能都不大，所以我们可以使用优秀的样式库来实现。比如，使用[Normalize.css](http://necolas.github.io/normalize.css/)来代替`_reset`

### 动画样式
如果某些`duang`的特效需要编写动画，则最好单独放在一个文件夹中，因为动画一般是比较独立的，又需要较多的代码量，还需要一些其他的兼容处理，单独在一个文件中比较容易管理，也预防日后需求变更，或者是积累代码日后重用。

### 布局样式
根据项目的需求和运行平台，可以大致确定项目的整体布局，是固定布局还是栅格布局，又或者是rem或flex布局。关于后面三种布局方式，我整理了单独的文件，根据需要在项目入口文件`_layout`灵活引入。

### 组件样式
实际上我对于组件啊模块啊的概念仍处于一个比较模糊的概念。我对于组件的理解是：同时出现在多个页面的某种特定元素及其子元素所组成的布局和样式。简而言之就是抽取出可复用的代码，比如`tabs`，`collapse`，`btn`这些重复出现的HTML结构及样式。
`utils`文件夹下主要存放的就是各个组件的样式，每个组件都被`_utils.scss`文件引入，然后在`main`文件中引入`_utils`
。在切图之前，应该大致先浏览全部的设计图，明确哪些地方是可以重用的组件，心中有数才开始写代码，比一上来就从首页开始，从上到下，从左到右闷头写要好的多。
另外，随着代码量的增加，甚至可以抽取出多个项目公用的组件样式，通过在入口文件控制是否引入，另外由于单个组件样式位于独立的文件，定位和修改就十分方便了。。

### 页面样式
尽管每个页面的样式细节可能不太一样，但按照整体布局或者逻辑功能也可以将他们进行分组。比如一个商城：
* 登陆注册（注册，登陆，验证...） - 功能
* 首页 - 独立
* 热门，新品，折扣（统一的侧边栏、主界面宽度，广告...） - 排版
* 购物车（订单，支付...） - 功能
* 页眉，页脚 - 排版

根据页面的分组，定义相关页面的容器名称，或是使用`%`定义相关的父类选择器提供继承继承。

## 样式命名重用
之前花了很多时间思考选择器的命名，最后是参照[NEC](http://nec.netease.com/standard/css-practice.html)
* `g-`布局
* `m-`模块
* `u-`元件

呃好吧，这个命名规范我现在仍处于摸索阶段，也遇见了一些坑，比如：布局命名`.sec-hd`和模块子元素命名`.tab-sec .sec-hd`这里就冲突了。不过，使用`hd`,`sd`,`mn`这些，确实能大大提高选择器命名的时间，之前一个名字真的要想很久。

至于样式重用，也有一个比较蛋疼的地方：正确的抽取出公共样式，并在页面上很多地方都用上了，用的很爽，然而某一天，需求改了，某个地方的样式需要改动一下，此时，一不小心就会改动到很多地方（这就是错误使用样式重用的一个体现），这种情况下，可能只能小心翼翼地添加类名限制，进行样式覆盖，代码越来越多，越改越难（我现在这个项目就发生了这个情况...）。

## 写文档
CSS有什么文档好写的？一个月前的CSS代码，真的只有上帝知道是怎么回事了。
在拿到设计图和需求文档之后，应当先大致整理整个项目的流程，后端同事是按照页面写逻辑的，在动手写页面之前就应该由我们剔除设计图上的坑（多余的功能，难以实现的分页等），并把项目的逻辑理顺，这不仅仅是为了后端，更是防止日后页面的大改动（逻辑一改页面肯定跟着动的）。而整理项目的逻辑和流程，除了依靠最原始的需求文档，我觉得我们也应该考虑书写前端的开发文档，包括项目的功能模块分类，技术选择等。
另外，浏览设计图时，将公共样式，页面的分组，JS的模块等也记录在文档中，方便日后的维护。此外也可以在样式表中适当添加一些注释，真的，肯定有用到的时候！

## 其他
此外还有两个小小的心得。
* 前面切好的小图标没有必要就直接做成精灵图，等待项目快上线的时候再弄（使用[工具](http://www.cn.spritegen.website-performance.org/)快速生成）可以节省大量的重复修改时间
* 能定义变量就定义变量，不要再其他的样式表中出现独立的诸如颜色之类的属性值，一个该死的需求会气死人的！（我会说客户把LOGO都改了然后页面全部颜色都替换吗？幸好机智地存了变量！）

任重而道远啊。