---
title: 关于CSS选择器嵌套的思考
date: 2016-10-04 09:38:30
tags:
	- 代码格式
categories:
	- CSS
---
选择器命名对于样式表的作用至关重要；另一方面，选择器的嵌套可能也是比较重要的，选择器的嵌套决定了样式规则的权重值，浏览器的渲染效率等。当然，在《Sass与Compass实战》这本书中指出，“CSS的解析效率在页面加载速度中的影响力是比较低的”，论坛上有位网友指出，CSS 的解析时间跟 js 执行时间相比就像 PHP 代码的运行时间和数据库、I/O运行时间对比一样，不是一个数量级，因此不用担心。
所以这篇关于CSS选择器嵌套的文章，就当是国庆在家百无聊赖而折腾出来的吧。
<!--more-->
## CSS解析顺序
很早之前就提到（是在张鑫旭大神的博客上看见的），浏览器解析CSS选择器的顺序是从右向左的，而非我们书写时的语义上的从左向右。为什么会做出这样“反人类的”规定呢？这是在[stackoverflow上查到的答案](http://stackoverflow.com/questions/5797014/why-do-browsers-match-css-selectors-from-right-to-left)。
由于浏览器是根据节点树来匹配对应的选择器，如果是按照从左往右的顺序，则会在匹配失败后回溯到上一层重新匹配下一个节点，当节点树的规模十分庞大时，如此往复会造成巨大的浪费。相反，从右往左进行匹配，最开始就会筛选到目标元素，然后再判断其父元素是否符合条件，这样会大大减少不必要节点的匹配判断。然而需要注意的是，由于是从右往左进行匹配的，因此，浏览器会判断处于最右端的所有元素，如果是一个通配选择符，那么效率可能就不会那么高了（因为这会匹配页面上的全部元素，再判断其父元素是否满足要求）。不单单是通配选择符，如果页面上存在大量的同类选择器，比如a标签，那么浏览器也会对全部的a标签进行判断。解决这个问题，__可以使用类选择器代替标签选择器__，（解决问题的同时带来的麻烦大概就是如何为这些标签选择一个合适的类名）。

## 嵌套深度
选择器的匹配大概是一个递归的过程，从右往左，筛选出对应的元素并向上判断其父元素是否符合条件，依此递归，如果选择器的修饰过长（即嵌套层次过深），则额外的花费就会更多，因此，应尽量减少选择器的嵌套，这正是这篇文章的主题，自打用上LESS之后就一直在思考这个问题，略有一点总结。
选择器的嵌套取决于页面结构，而又决定了样式的权重值。因此，为了将正确的样式规则应用在正确的元素上，就必须指定正确的选择器，并保证该选择器样式的权重值最为优先才行。
SCSS,LESS这些工具所提供的选择器嵌套，极大地方便了选择器的书写，且能够很直观的看出页面结构。但是，如果一味按照页面结构来嵌套选择器，那么编译出来的CSS文件可能会十分恐怖，在不经意间甚至达到六七层嵌套（我曾经在body上定义了一个类作为该页面的选择器作用域，然后糊里糊涂地在里面进行嵌套，后面在线上需要直接修改CSS文件时，简直是一场灾难）。
此外，选择器嵌套极大程度上限制了样式的重用，所需要的限定越多，能够重用的部分越少，甚至没有任何重用的可能性。
总结一下，关于选择器嵌套所带来的问题：
* 嵌套越深，浏览器需要的解析时间越长。
* 嵌套越深，样式的重用性越低。
* 嵌套越深，CSS文件越难维护。

实际上，__后代选择器在标准中其实是一种不那么被推荐的写法__。那么，我们在书写CSS时，应在保证样式正确权重值，且能够匹配到正确元素的情况下，尽可能减少选择器的嵌套，剔除不必要的父元素，精简选择器的结构，比如移除多余的标签选择器。此外，选择器嵌套不应当仅仅是书写CSS文件时应当考虑的，正如前面所说，书写正确的HTML文档结构才是决定CSS选择器嵌套的关键。

最后，由于ID选择器是页面唯一的，因此不需要有任何父选择器进行修饰（当然为了样式重用应少使用ID选择器）。


