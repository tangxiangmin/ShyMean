---
title: DOM中的事件处理
date: 2016-06-07 22:27:04
tags:
	- 事件
	- DOM
categories:
	- JavaScript
---
记忆中某天在某个个人网站上看见一个非常酷炫的效果：整个页面都是萤火虫似的小光点组成的LOGO，鼠标滑过的时LOGO被打散，屏幕上泛起阵阵涟漪，鼠标停止又变换图形。当时非常震撼，甚至于忘了保存链接。这就成了我现在正在奋斗的一个目标。正巧刚看完客户端JS关于事件处理的部分，下面简单整理了一下JS中关于事件及相关的一些知识点。
<!--more-->
## 事件
当文档、浏览器、元素或与之相关的对象发生某些有趣的事情时，浏览器就会产生事件；也可以说成是浏览器通知应用程序发生了什么事情。关于事件的几个名词解释列于图中。
![js事件](uploads/event.png)

## 几个概念
然后是几个需要注意的地方。

区分事件目标与事件对象
> 这两者在概念上是很容易区别的，只是初学的时候对概念不屑一顾的态度让我走了一点弯路。一个事件，是在某个事件目标（小至一个按钮、大到整个文档）上所发生的，而与该事件有关的详细信息（如鼠标坐标、target属性等）则保存在事件对象中。

兼容作为参数的事件对象与作为全局对象的事件对象
> 利用“||”运算符的短路运算可以解决：event = event||window.event。此外需要注意事件对象并不是事件处理函数所必需的，只是某些处理函数需要事件对象的某些属性罢了。

事件处理函数的注册
> 通过为HTML标签设置事件处理函数的方式违背了结构行为分离的准则，不建议使用； 通过设置事件目标属性的方式注册的事件函数只会存在一个，后注册的事件处理函数会覆盖前面注册的函数。

事件处理函数的调用上下文
> 事件处理函数一般作为事件目标的方法调用，因此其中的this指代的就是这个事件目标对象。但是使用attchEvent注册事件的时候其中的this是window全局对象。

事件的默认操作
> 通常情况下的return false表明禁止执行该事件相关的默认操作（比如点击超链接禁止跳转页面），不过这种通过返回值关闭默认操作只在通过事件目标属性注册才有效果。在其他形式注册的事件下需要事件对象调用其对应的方法。

## 事件传播
事件传播有事件捕获和事件冒泡两种形式，他们决定了事件处理函数的调用顺序，在模型上跟作用力与反作用力十分相似，但是捕获与冒泡的用途是不一样的，这里现在只是大致了解原理，具体的应用需要逐步掌握。
### 事件捕获
当触发了一个事件之后，事件从最外层的window对象开始向document对象传播并到达至最内层的事件目标为止，并调用在传播路径上的每个对象的事件捕获处理函数（如果存在的话），这就是事件捕获过程。只能通过addEventListener()且将第三个参数设置为true的方式才能注册事件捕获处理函数；而通过事件目标属性注册的事件函数均为事件冒泡处理函数。事件捕获在IE8之前的浏览器不被支持。
事件捕获模型提供了在事件没有被送达目标之前查看他们的机会，能用于调试。
### 事件冒泡
当最内层事件目标调用其事件处理函数之后，事件将从事件目标沿着DOM树传播至根部，并调用在传播路径上的每个对象的事件冒泡处理函数。focus，blur，scroll，load,change等事件不会冒泡（至于其他不会冒泡的事件待收集）。冒泡机制被所有浏览器支持。
事件冒泡模型在为大量单独元素上注册处理程序提供了解决方案（在其公有祖先元素上注册事件,即事件委托）。事件委托就是事件目标不直接处理事件，而是委托其父元素或者祖先元素甚至根元素（document）的事件处理函数进行处理。可以通过事件对象的target属性获得真正触发事件的引用。事件委托是建立在冒泡模型之上的。
## jquery中的事件封装
接下来是jQuery中对于事件的处理，jQuery中定义了几种关于注册事件的方法：
> bind()
> live()
> delegate()
> on()
> off()
> one()

这几种方法都是通过冒泡方式进行事件函数调用的，且均支持一个事件目标上，针对一个或多个事件，同时绑定数个事件处理函数；此外这几种方法return false可以同时阻止默认行为与事件冒泡。
* 鉴于历史原因（如选择器支持，函数执行效率等方面），live()方法已经被删除；
* bind()方法只能针对已经存在的元素进行事件设置（无法为进行事件委托，且为多个元素绑定相同事件时内存开销很大），因此推荐使用on()代替；
* 在事件绑定与事件委派方面，on()与delegate()方法是等效的，具体的区别从查到的资料上感觉并不让人信服，可能是为了统一规范事件绑定与委派吧，推荐使用on()。

可以很方便的通过on()方法为同一个元素注册多个事件处理函数，也可以为多个元素注册同一个事件处理函数（结合强大的jQuery选择器）；移除已注册的事件处理函数也非常简单，可以使用off()方法。
off()方法对应于on()，取代了 unbind()、die() 和 undelegate() 这几个移除事件处理函数的方法；此外对于只需要触发一次，随后就要立即解除绑定的情况，jQuery还提供了一个one()方法，使用one()方法注册的事件处理函数执行一次之后就被移除。
由于并不是所有浏览器都支持事件捕获，且这种情况无法通过判断兼容性等方式来弥补，因此jQuery并不支持事件捕获。

## 最后
事件是前端中一个非常重要的知识点，现在学到的不过是一点皮毛，需要百尺竿头，加倍努力啊。


