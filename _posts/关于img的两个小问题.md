---
title: 关于img的两个小问题
date: 2016-06-14 20:18:28
tags:
	- Bugs
	- 样式
categories:
	- CSS
---
在实际练习中使用图片时经常碰见两个问题：图片的实际高度与换行。今天把在坑里面得到的收获整理一下。
<!--more-->

## 图片容器的高度
关于图片高度的问题已经碰到过很多次了，以前还以为是兼容问题，简单的加上一个img {display block}就能够解决了，后来才明白问题的根源弄错了。先简单的描述一下问题：在默认情况下，当一个容器的高度是由内部的图片内容撑开的时候，其高度会比图片的实际高度会多出几个像素（3px？）。嗯，就是这么个小问题：
```
    <div class="wrap">
        <img src="1.png" />hello
    </div>
```
右键查看盒子模型可以很清楚的看见这个问题。最初百思不得其解，还以为是什么神奇的BUG，其实这是文本渲染正常显示的结果。为了搞定这个问题，需要了解两个知识点：img标签的vertical align属性和字体的基准线baseline。
### baseline
baseline是西文字体中的概念，百科的定义是大部分字母所“坐”在的，字体的下降部之上的直线（好吧这个解释感觉很扯淡，转念想一想以前抄写单词的时候用的四线行练习本，有基线这个概念的够了。）中文采用的是宫格排版，因此没有基线概念（是不是由于以前的排版都是竖着的缘故...）。

### vertical-align
img标签是一个内联-块状元素，当然这个跟该问题的牵连并不是很大。我们的目光应当放在其具有的vertical align属性上。这个属性直译为“竖直方向上对齐”，对齐指的是相邻的内联元素排版时定位参照的方式，对应的值有bottom,top,middle等，而默认的值就是上面提到的baseline。baseline距离文字的底部bottom有一定的高度（bottom和top之间的距离是行高，baseline和bottom之间的距离就是问题中所多出来的那几个像素，即使图片旁边并没有文字，也会按照默认的格式进行排版从而产生间距）。
关于vectical-align这个问题，[这篇文章](https://css-tricks.com/what-is-vertical-align/)写得更加全面。

### 解决方案
图片排版多出来的这几个像素，表面上也没有什么影响，但在某些情况下会造成难以排查的BUG，比如浮动的块会卡住后面的浮动元素（饱受摧残，引以为戒，泪奔中）。
知道了问题的根源，解决这个问题就很容易了：
* 简单粗暴法：既然是文字排版的问题，对img使用display:block真是一劳永逸啊。缺点是会让其旁边的文字换行，适合单纯的只是为了消除多出来的那几个像素的情况下；
* 追根溯源法：改变vectical align默认值为bottom,middle等需要的属性值，或者是vectical-align:-3px，完美解决；
* 旁门左道法：设置其父容器的font-size大小为0，缺点是字没了；或者是line-height为0，字样旁边文字的基线以下部分会溢出容器。

## 莫名奇妙的间隙
在写代码的时候通常使用换行加缩进等方式增加阅读性，导致两个相邻的图片之间存在了一条莫名奇妙的间距，并且在盒子模型中还看不见任何margin的存在（不要说了，都是泪...）。这就是img标签内嵌-块状元素中的“内联”属性在作怪，并没有什么知识点可言。
### 解析换行
其实不单是图片，所有内联元素及内联-块状元素都会解析在HTML文档中的空格与换行，只是由于有了“代码的格式只会影响代码阅读性，不会影响代码的运行结果”这种先入为主的念头，因此一直没有重视罢了。
### 解决方案
那么，怎么解决换行所产生的间距呢？有下面几个方法：
* 为内联-块状元素的父容器指定其font-size:0，并显示指定子元素的字体大小（在需要的情况下比如文本框等），这样可完美解决这个问题。
* 不换行或者不使用空格，这样间距自然也就消失了，但是，代码的阅读性大大下降，并不可取（除非项目上线前进行代码压缩的时候）；
* 借助换行的空注释连接两行，会在HTML文档中产生大量的注释，而注释本身又是为了加强代码的阅读性的，因此并不可取；
* 使用负的margin值可以达到目的；
* 此外还有一些其他的方法，比如负的letter-spacing和word-spacing等。如果要从完全解决解析换行的问题，可以使用浮动。

## 总结
上面两个问题可以看作是图片元素所具有的内联文本的一些默认规则，需要小心提防。